{"filter":false,"title":"SessionState.php","tooltip":"/security/Models/SessionState.php","undoManager":{"mark":64,"position":64,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":82,"column":1},"action":"insert","lines":["<?php","namespace cellControl;","if (PHP_OS === \"WINNT\") {","    ini_set('error_reporting', E_ALL);","    ini_set(\"display_errors\", 1);","    ini_set(\"display_startup_errors\", 1);","}","require_once(dirname(__DIR__) . DIRECTORY_SEPARATOR . 'vendor/autoload.php');","","use \\cellControl\\RedisSessionHandler;","","class SessionInitializers","{","    const RESTART_TIMER = 2700;","    public function __construct()","    {","        self::setCSRFToken();","        self::constructDefaults(self::RESTART_TIMER);","    }","    protected static function constructDefaults($RESTART_TIMER)","    {","        $params = session_get_cookie_params();","        if (!isset($_SESSION['CREATED'])) {","            $_SESSION['CREATED'] = time();","            session_set_cookie_params(","                $RESTART_TIMER,","                $params[\"path\"],","                $params[\"domain\"],","                $params[\"secure\"],","                $params[\"httponly\"]","            );","        } elseif (intval(time() - $_SESSION['CREATED']) > $RESTART_TIMER) {","            self::destroySession();","        } elseif (intval(time() - $_SESSION['CREATED']) <= $RESTART_TIMER) {","            $_SESSION['CREATED'] = time();","            /* This recaches the time so that if someone is actively using the page, it does not log them out. */","            $params = session_get_cookie_params();","            setcookie(","                session_name(),","                session_id(),","                intval(time()+$RESTART_TIMER),","                $params[\"path\"],","                $params[\"domain\"],","                $params[\"secure\"],","                $params[\"httponly\"]","            );","        }","    }","    protected static function destroySession()","    {","        session_write_close();","        session_unset();","        $_SESSION = array();","        foreach ($_COOKIE as $key => $value) {","            unset($_COOKIE[$key]);","        }","        if (ini_get(\"session.use_cookies\")) {","            setcookie(","                session_name(),","                session_id(),","                time() - 42000,","                $params[\"path\"],","                $params[\"domain\"],","                $params[\"secure\"],","                $params[\"httponly\"]","            );","        }","        session_destroy();","    }","    protected static function setCSRFToken()","    {","        if (!isset($_SESSION['csrf_token'])) {","            if (version_compare(PHP_VERSION, '5.5.0', '>=')) {","                    $token = password_hash(str_shuffle(base64_encode(time() . bindec(openssl_random_pseudo_bytes(32)))), PASSWORD_BCRYPT);","                    $_SESSION['csrf_token'] = $token;","            } elseif (version_compare(PHP_VERSION, '5.1.2', '>=')) {","                $_SESSION['csrf_token'] = hash('whirlpool', str_shuffle(base64_encode(time() . bindec(openssl_random_pseudo_bytes(32)))));","            } else {","                $_SESSION['csrf_token'] = str_shuffle(base64_encode(time() . bindec(openssl_random_pseudo_bytes(32))));","            }","        }","    }","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":0},"end":{"row":6,"column":1},"action":"remove","lines":["if (PHP_OS === \"WINNT\") {","    ini_set('error_reporting', E_ALL);","    ini_set(\"display_errors\", 1);","    ini_set(\"display_startup_errors\", 1);","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":10},"end":{"row":1,"column":21},"action":"remove","lines":["cellControl"]},{"start":{"row":1,"column":10},"end":{"row":1,"column":11},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":11},"end":{"row":1,"column":12},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":12},"end":{"row":1,"column":13},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":13},"end":{"row":1,"column":14},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":14},"end":{"row":1,"column":15},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":15},"end":{"row":1,"column":16},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":16},"end":{"row":1,"column":17},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":16},"end":{"row":1,"column":17},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":15},"end":{"row":1,"column":16},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":15},"end":{"row":1,"column":16},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":16},"end":{"row":1,"column":17},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":17},"end":{"row":1,"column":18},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":18},"end":{"row":1,"column":19},"action":"insert","lines":["\\"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":19},"end":{"row":1,"column":20},"action":"insert","lines":["M"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":20},"end":{"row":1,"column":21},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":22},"end":{"row":1,"column":23},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":23},"end":{"row":1,"column":24},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":24},"end":{"row":1,"column":25},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":5,"column":37},"action":"remove","lines":["use \\cellControl\\RedisSessionHandler;"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":6},"end":{"row":5,"column":25},"action":"remove","lines":["SessionInitializers"]},{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":8},"end":{"row":5,"column":9},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":9},"end":{"row":5,"column":10},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":10},"end":{"row":5,"column":11},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":11},"end":{"row":5,"column":12},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":12},"end":{"row":5,"column":13},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":13},"end":{"row":5,"column":14},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":14},"end":{"row":5,"column":15},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":15},"end":{"row":5,"column":16},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":16},"end":{"row":5,"column":17},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":17},"end":{"row":5,"column":18},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"remove","lines":["require_once(dirname(__DIR__) . DIRECTORY_SEPARATOR . 'vendor/autoload.php');",""]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":4},"end":{"row":74,"column":5},"action":"remove","lines":["const RESTART_TIMER = 2700;","    public function __construct()","    {","        self::setCSRFToken();","        self::constructDefaults(self::RESTART_TIMER);","    }","    protected static function constructDefaults($RESTART_TIMER)","    {","        $params = session_get_cookie_params();","        if (!isset($_SESSION['CREATED'])) {","            $_SESSION['CREATED'] = time();","            session_set_cookie_params(","                $RESTART_TIMER,","                $params[\"path\"],","                $params[\"domain\"],","                $params[\"secure\"],","                $params[\"httponly\"]","            );","        } elseif (intval(time() - $_SESSION['CREATED']) > $RESTART_TIMER) {","            self::destroySession();","        } elseif (intval(time() - $_SESSION['CREATED']) <= $RESTART_TIMER) {","            $_SESSION['CREATED'] = time();","            /* This recaches the time so that if someone is actively using the page, it does not log them out. */","            $params = session_get_cookie_params();","            setcookie(","                session_name(),","                session_id(),","                intval(time()+$RESTART_TIMER),","                $params[\"path\"],","                $params[\"domain\"],","                $params[\"secure\"],","                $params[\"httponly\"]","            );","        }","    }","    protected static function destroySession()","    {","        session_write_close();","        session_unset();","        $_SESSION = array();","        foreach ($_COOKIE as $key => $value) {","            unset($_COOKIE[$key]);","        }","        if (ini_get(\"session.use_cookies\")) {","            setcookie(","                session_name(),","                session_id(),","                time() - 42000,","                $params[\"path\"],","                $params[\"domain\"],","                $params[\"secure\"],","                $params[\"httponly\"]","            );","        }","        session_destroy();","    }","    protected static function setCSRFToken()","    {","        if (!isset($_SESSION['csrf_token'])) {","            if (version_compare(PHP_VERSION, '5.5.0', '>=')) {","                    $token = password_hash(str_shuffle(base64_encode(time() . bindec(openssl_random_pseudo_bytes(32)))), PASSWORD_BCRYPT);","                    $_SESSION['csrf_token'] = $token;","            } elseif (version_compare(PHP_VERSION, '5.1.2', '>=')) {","                $_SESSION['csrf_token'] = hash('whirlpool', str_shuffle(base64_encode(time() . bindec(openssl_random_pseudo_bytes(32)))));","            } else {","                $_SESSION['csrf_token'] = str_shuffle(base64_encode(time() . bindec(openssl_random_pseudo_bytes(32))));","            }","        }","    }"]},{"start":{"row":6,"column":4},"end":{"row":17,"column":5},"action":"insert","lines":[" protected static function sessionHasStarted()","    {","        if (version_compare(PHP_VERSION, '5.4.0', '>=')) {","            if (session_status() == PHP_SESSION_NONE) {","                return false;","            } elseif (session_status() === PHP_SESSION_ACTIVE) {","                return true;","            }","        } elseif (session_id() == '') {","            return false;","        }","    }"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":5},"end":{"row":6,"column":14},"action":"remove","lines":["protected"]},{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":7},"end":{"row":6,"column":8},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":8},"end":{"row":6,"column":9},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":9},"end":{"row":6,"column":10},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":10},"end":{"row":6,"column":11},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":12},"end":{"row":6,"column":19},"action":"remove","lines":["static "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":9},"end":{"row":17,"column":0},"action":"insert","lines":["",""]},{"start":{"row":17,"column":0},"end":{"row":17,"column":8},"action":"insert","lines":["        "]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":8},"end":{"row":17,"column":9},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":9},"end":{"row":17,"column":10},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":10},"end":{"row":17,"column":11},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":11},"end":{"row":17,"column":12},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":12},"end":{"row":17,"column":13},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":12},"end":{"row":17,"column":13},"action":"remove","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":11},"end":{"row":17,"column":12},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":11},"end":{"row":17,"column":12},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":12},"end":{"row":17,"column":13},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":13},"end":{"row":17,"column":14},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":14},"end":{"row":17,"column":15},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":15},"end":{"row":17,"column":16},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":16},"end":{"row":17,"column":17},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":17},"end":{"row":17,"column":18},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":18},"end":{"row":17,"column":19},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":19},"end":{"row":17,"column":20},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"remove","lines":[" "]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":12,"column":27},"end":{"row":12,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1417968178446,"hash":"f4337345cc77f5b3aa4d1401267b703e1b897a44"}