{"changed":true,"filter":false,"title":"12-fakeGroupsToCompaniesToUsers.php","tooltip":"/security/DataBase/faker/12-fakeGroupsToCompaniesToUsers.php","value":"<?php\n\n// MySQL Only, create database permission for specific users.\n\n$valueString = \"-- CREATE USER 'widgetAdmin'@'%' IDENTIFIED BY 'somepassword';\n-- CREATE USER 'widgetCorporate'@'%' IDENTIFIED BY 'somepassword';\n-- CREATE USER 'widgetCustomer'@'%' IDENTIFIED BY 'somepassword';\n\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.* TO 'widgetSuper'@'%' IDENTIFIED BY 'somepassword';\n\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.groups TO 'widgetAdmin'@'%' IDENTIFIED BY 'somepassword'; \nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.users TO 'widgetAdmin'@'%' IDENTIFIED BY 'somepassword';\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.orders TO 'widgetAdmin'@'%' IDENTIFIED BY 'somepassword';\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.companies TO 'widgetAdmin'@'%' IDENTIFIED BY 'somepassword';\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.customers TO 'widgetAdmin'@'%' IDENTIFIED BY 'somepassword';\n\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.groups TO 'widgetCorporate'@'%' IDENTIFIED BY 'somepassword'; \nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.users TO 'widgetCorporate'@'%' IDENTIFIED BY 'somepassword';\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.orders TO 'widgetCorporate'@'%' IDENTIFIED BY 'somepassword';\n\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.customers TO 'widgetCustomer'@'%' IDENTIFIED BY 'somepassword';\nGRANT SELECT, INSERT, UPDATE, DELETE ON widgets.orders TO 'widgetCustomer'@'%' IDENTIFIED BY 'somepassword';\n\n--//@UNDO\nDROP USER 'widgetSuper'@'%';\nDROP USER 'widgetAdmin'@'%';\nDROP USER 'widgetCorporate'@'%';\nDROP USER 'widgetCustomer'@'%';\n--//\n\";\n\n$seedsFile = dirname(__DIR__) . \"/deltas/seeds/mysql/12-userPermissions.sql\";\nif (!file_exists($seedsFile)) {\n    touch($seedsFile);\n}\nfile_put_contents($seedsFile, $valueString);\n","undoManager":{"mark":16,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":50,"column":8},"end":{"row":50,"column":9},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":9},"end":{"row":50,"column":10},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":10},"end":{"row":50,"column":11},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":11},"end":{"row":50,"column":12},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":12},"end":{"row":50,"column":13},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":13},"end":{"row":50,"column":14},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":14},"end":{"row":50,"column":15},"action":"insert","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":15},"end":{"row":50,"column":16},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":58,"column":0},"end":{"row":69,"column":0},"action":"remove","lines":["    if (isset($debug) && $debug) {","        echo $groupID . PHP_EOL;","        echo $userID . PHP_EOL;","        echo $groupsPerCompany . PHP_EOL;","        echo $usersPerCompany . PHP_EOL;","        echo $groupsID . PHP_EOL;","        echo $usersID . PHP_EOL;","        echo $length . PHP_EOL;","        echo $modulus . PHP_EOL;","    }","    ",""]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":0},"end":{"row":16,"column":0},"action":"remove","lines":["$query = \"SELECT companies.id as corporateID FROM companies\";",""]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":0},"end":{"row":16,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":92,"column":0},"action":"remove","lines":["foreach ($pdo->query($query) as $row) {","    $corporateID = $row['corporateID'];","    $queryModulus = \"SELECT COUNT(*) as groupsPerCompany ","                     FROM groups WHERE companies_id = $corporateID\";","    foreach ($pdo->query($queryModulus) as $row) {","        $groupsPerCompany = $row['groupsPerCompany'];","    }","    $queryGroup = \"SELECT id as groupID ","                     FROM groups WHERE companies_id = $corporateID\";","    foreach ($pdo->query($queryGroup) as $row) {","        $groupsID[] = $row['groupID'];","    }","    $queryUserModulus = \"SELECT COUNT(*) as usersPerCompany FROM users","                         WHERE users.company_id = $corporateID\";","    foreach ($pdo->query($queryUserModulus) as $row) {","        $usersPerCompany = $row['usersPerCompany'];","    }","    ","    $queryUsers = \"SELECT id as userID FROM users WHERE users.company_id = $corporateID\";","    foreach ($pdo->query($queryUsers) as $row) {","        $usersID[] = $row['userID'];","    }","    $userID = implode(',', $usersID);","    $groupID = implode(',', $groupsID);","    ","    $usersToCompany[$corporateID]['groupID'] = $groupID;","    $usersToCompany[$corporateID]['userID'] = $userID;","    $usersToCompany[$corporateID]['totalGroups'] = $groupsPerCompany;","    $usersToCompany[$corporateID]['totalUsers'] = $usersPerCompany;","    $usersToCompany[$corporateID]['groupArray'] = $groupsID;","    $usersToCompany[$corporateID]['usersArray'] = $usersID;","    $length = 0;","    if ($groupsPerCompany !== 0) {","        $length = intval($usersPerCompany / $groupsPerCompany);","    }","    $modulus = intval($usersPerCompany % $groupsPerCompany);","    $usersToCompany[$corporateID]['length'] = $length;","    $usersToCompany[$corporateID]['modulus'] = $modulus;","    ","    if ($modulus > 0) {","        $length += 1;","    }","    ","    $groupCount = count($groupsID);","    for ($i = 0; $i < $groupCount; $i++) {","        $usersToCompany[$corporateID]['groupsWithUsers'][$groupsID[$i]] = ","            array_chunk($usersToCompany[$corporateID]['usersArray'], $length);","        $throwAway = array_chunk($usersToCompany[$corporateID]['usersArray'], $length);","    }","    $lengthAmount = count($throwAway);","    for ($i = 0; $i < $lengthAmount; $i++) {","        $users = implode(',', $usersToCompany[$corporateID]['groupsWithUsers'][$groupsID[$i]][$i]);","        $mysqlValues[] = \"UPDATE groups SET groups.users_id = '$users' WHERE groups.companies_id = $corporateID","              AND groups.id = {$groupsID[$i]}\";","        $sqliteValues[] = \"UPDATE groups SET groups.users_id = '$users' WHERE groups.companies_id = $corporateID","              AND groups.id = {$groupsID[$i]}\";","        $querySelectUser = \"SELECT users_id FROM groups WHERE id = {$groupsID[$i]}\";","        foreach($pdo->query($querySelectUser) as $row) {","            $arr = explode(',', $row['users_id']);","            foreach ($arr as $value) {","                $mysqlValues[] = \"UPDATE users SET users.group_id ={$groupsID[$i]} ","                                  WHERE users.company_id = $corporateID","                                  AND users.id = {$value}\";","                $sqliteValues[] = \"UPDATE users SET users.group_id ={$groupsID[$i]} ","                                  WHERE users.company_id = $corporateID","                                  AND users.id = {$value}\";","                ","            }","        }","    }","    ","    ","    ","    $groupsID = $usersID = [];","}",""]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":18,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":17,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":1},"end":{"row":17,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":2},"end":{"row":17,"column":3},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":3},"end":{"row":17,"column":43},"action":"insert","lines":["`id`, `name`, `companies_id`, `users_id`"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":0},"end":{"row":19,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":0},"end":{"row":18,"column":1},"action":"insert","lines":["$"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":1},"end":{"row":18,"column":2},"action":"insert","lines":["q"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":2},"end":{"row":18,"column":3},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":3},"end":{"row":18,"column":4},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":4},"end":{"row":18,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":5},"end":{"row":18,"column":6},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":6},"end":{"row":18,"column":7},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":7},"end":{"row":18,"column":8},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":8},"end":{"row":18,"column":9},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":9},"end":{"row":18,"column":10},"action":"insert","lines":["I"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":10},"end":{"row":18,"column":11},"action":"insert","lines":["N"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":11},"end":{"row":18,"column":12},"action":"insert","lines":["S"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":12},"end":{"row":18,"column":13},"action":"insert","lines":["E"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":13},"end":{"row":18,"column":14},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":13},"end":{"row":18,"column":14},"action":"remove","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":13},"end":{"row":18,"column":14},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":14},"end":{"row":18,"column":15},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":15},"end":{"row":18,"column":16},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":16},"end":{"row":18,"column":17},"action":"insert","lines":["I"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":17},"end":{"row":18,"column":18},"action":"insert","lines":["N"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":18},"end":{"row":18,"column":19},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":19},"end":{"row":18,"column":20},"action":"insert","lines":["O"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":20},"end":{"row":18,"column":21},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":21},"end":{"row":18,"column":22},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":22},"end":{"row":18,"column":23},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":23},"end":{"row":18,"column":24},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":24},"end":{"row":18,"column":25},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":25},"end":{"row":18,"column":26},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":26},"end":{"row":18,"column":27},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":9},"end":{"row":18,"column":10},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":28},"end":{"row":18,"column":29},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":29},"end":{"row":18,"column":30},"action":"insert","lines":["\""]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":28},"end":{"row":18,"column":29},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":29},"end":{"row":18,"column":30},"action":"insert","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":30},"end":{"row":18,"column":31},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":31},"end":{"row":18,"column":32},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":32},"end":{"row":18,"column":33},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":33},"end":{"row":18,"column":34},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":34},"end":{"row":18,"column":35},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":35},"end":{"row":18,"column":36},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":36},"end":{"row":18,"column":37},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":37},"end":{"row":18,"column":38},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":38},"end":{"row":18,"column":39},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":39},"end":{"row":18,"column":40},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":40},"end":{"row":18,"column":41},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":41},"end":{"row":18,"column":42},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":42},"end":{"row":18,"column":43},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":43},"end":{"row":18,"column":44},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":44},"end":{"row":18,"column":45},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":45},"end":{"row":18,"column":46},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":46},"end":{"row":18,"column":47},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":47},"end":{"row":18,"column":48},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":48},"end":{"row":18,"column":49},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":49},"end":{"row":18,"column":50},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":50},"end":{"row":18,"column":51},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":51},"end":{"row":18,"column":52},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":52},"end":{"row":18,"column":53},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":53},"end":{"row":18,"column":54},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":54},"end":{"row":18,"column":55},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":55},"end":{"row":18,"column":56},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":56},"end":{"row":18,"column":57},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":57},"end":{"row":18,"column":58},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":58},"end":{"row":18,"column":59},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":59},"end":{"row":18,"column":60},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":60},"end":{"row":18,"column":61},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":61},"end":{"row":18,"column":62},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":62},"end":{"row":18,"column":63},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":65},"end":{"row":18,"column":66},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":64},"end":{"row":19,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":0},"end":{"row":19,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":4},"end":{"row":19,"column":8},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":8},"end":{"row":19,"column":9},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":30},"end":{"row":18,"column":40},"action":"remove","lines":["id, name, "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":0},"end":{"row":32,"column":44},"action":"remove","lines":["$mysqli = new MySQLISingleton();","","$pdo = new PDOSingleton();","","$mysqlValues = $sqliteValues = $usersToCompany = $groupsID = [];","","$debug = true;","","// `id`, `name`, `companies_id`, `users_id`","$query = \"INSERT INTO groups (companies_id, users_id) ","         \";","","// Begin MySQL SQL statements.","","$valueString = implode(\";\".PHP_EOL,$mysqlValues);","$valueString .= \";\";","$valueString .= PHP_EOL . \"--//@UNDO\" . PHP_EOL . \"SET FOREIGN_KEY_CHECKS = 0; ","TRUNCATE groups; ","SET FOREIGN_KEY_CHECKS = 1;\" . PHP_EOL . \"--//\";","$seedsFile = dirname(__DIR__) . \"/deltas/seeds/mysql/12-groupsToCompaniesToUsers.sql\";","if (!file_exists($seedsFile)) {","    touch($seedsFile);","}","file_put_contents($seedsFile, $valueString);"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":0},"end":{"row":10,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":8,"column":0},"action":"remove","lines":["use \\security\\Models\\Generator\\RandomGenerator;","use \\security\\Models\\MySQLISingleton;","use \\security\\Models\\PDOSingleton;","use \\PDO;",""]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"remove","lines":["include_once(dirname(dirname(dirname(__DIR__))) . DIRECTORY_SEPARATOR . 'vendor/autoload.php');",""]}]}],[{"group":"doc","deltas":[{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":0},"end":{"row":52,"column":44},"action":"remove","lines":["","/**"," * Begin SQLite Preparations"," */","","$valueString = implode(\";\".PHP_EOL,$sqliteValues);","$valueString .= \";\";","$valueString .= PHP_EOL . \"--//@UNDO\" . PHP_EOL . \"","PRAGMA foreign_keys=OFF;","delete from groups;","PRAGMA foreign_keys=ON;","\" . PHP_EOL . \"--//\";","$seedsFile = dirname(__DIR__) . \"/deltas/seeds/sqlite/11-groupsToCompaniesToUsers.sql\";","if (!file_exists($seedsFile)) {","    touch($seedsFile);","}","file_put_contents($seedsFile, $valueString);"]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":54},"end":{"row":31,"column":55},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":54},"end":{"row":31,"column":55},"action":"insert","lines":["2"]}]}]]},"ace":{"folds":[],"scrolltop":300,"scrollleft":0,"selection":{"start":{"row":31,"column":55},"end":{"row":31,"column":55},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":12,"state":"php-qqstring","mode":"ace/mode/php"}},"timestamp":1421615963278}